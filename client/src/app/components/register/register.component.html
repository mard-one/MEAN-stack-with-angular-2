<h1 class="page-header">Register</h1>

<div class="row show-hide-message">
  <div [ngClass]='messageClass'>
    {{ message }}
  </div>
</div>

<form class="form-horizontal" [formGroup]="form" (submit)="onRegistration()">
  <div class="form-group">

    <label class="control-label col-sm-2" for="email">Email:</label>

    <div class="col-sm-10" [ngClass]="{'has-error':((form.controls.email.errors && (form.controls.email.dirty || form.controls.email.touched)) || (!emailValid && (form.controls.email.dirty || form.controls.email.touched))), 'has-success':(!form.controls.email.errors)}" [ngClass]="{'has-error':(form.controls.email.errors && (form.controls.email.dirty || form.controls.email.touched)), 'has-success':(!form.controls.email.errors)}" >
      <input (keyup)="checkEmail()"  (blur)="checkEmail()" type="email" class="form-control" id="email" placeholder="Enter email" name="email" formControlName='email' >
      <ul class="help-block">
        <li *ngIf='form.controls.email.errors?.required && (form.controls.email.dirty || form.controls.email.touched)'>
          This field is required
        </li>
        <li *ngIf='(form.controls.email.errors?.minlength || form.controls.email.errors?.maxlength && (form.controls.email.dirty || form.controls.email.touched))'>
          E-mail must contain at least 5 charecters but no more than 30
        </li>
        <li *ngIf='form.controls.email.errors?.validateEmail && (form.controls.email.dirty || form.controls.email.touched)'>
          E-mail must be valid
        </li>
        <li *ngIf='emailMessage'>
          {{ emailMessage }}
        </li>
      </ul>
    </div>

  </div>
  <div class="form-group">

    <label class="control-label col-sm-2" for="username">Username:</label>

  <div class="col-sm-10" [ngClass]="{'has-error':((form.controls.username.errors && (form.controls.username.dirty || form.controls.username.touched)) || (!usernameValid && (form.controls.username.dirty || form.controls.username.touched))), 'has-success':(!form.controls.username.errors)}">
      <input (keyup)="checkUsername()" (blur)="checkUsername()" type="username" class="form-control" id="username" placeholder="Enter username" name="username" formControlName='username'>
      <ul class="help-block">
        <li *ngIf='form.controls.username.errors?.required && (form.controls.username.dirty || form.controls.username.touched)'>
          This field is required
        </li>
        <li *ngIf='(form.controls.username.errors?.minlength || form.controls.username.errors?.maxlength && (form.controls.username.dirty || form.controls.username.touched))'>
          Username must contain at least 3 charecters but no more than 15
        </li>
        <li *ngIf='form.controls.username.errors?.validateUsername && (form.controls.username.dirty || form.controls.username.touched)'>
          Username must be valid and must not have any special charecters
        </li>
        <li *ngIf='usernameMessage'>
          {{ usernameMessage }}
        </li>
      </ul>
    </div>

  </div>
  <div class="form-group">

    <label class="control-label col-sm-2" for="pwd">Password:</label>

    <div class="col-sm-10" [ngClass]="{'has-error':(form.controls.password.errors && (form.controls.password.dirty || form.controls.password.touched)), 'has-success':(!form.controls.password.errors)}">
      <input type="password" class="form-control" id="pwd" placeholder="Enter password" name="password" formControlName='password'>
      <ul class="help-block">
        <li *ngIf='form.controls.password.errors?.required && (form.controls.password.dirty || form.controls.password.touched)'>
          This field is required
        </li>
        <li *ngIf='(form.controls.password.errors?.minlength || form.controls.password.errors?.maxlength && (form.controls.password.dirty || form.controls.password.touched))'>
          Password must contain at least 8 charecters but no more than 15
        </li>
        <li *ngIf='form.controls.password.errors?.validatePassword && (form.controls.password.dirty || form.controls.password.touched)'>
          Password must be valid and must not have any special charecters
        </li>
      </ul>
    </div>

  </div>
  <div class="form-group">

    <label class="control-label col-sm-2" for="confirmPwd">Confirm password:</label>

    <div class="col-sm-10" [ngClass]="{'has-error':(form.controls.confirmPassword.errors && (form.controls.confirmPassword.dirty || form.controls.confirmPassword.touched) || form.errors?.matchingPasswords && (form.controls.confirmPassword.dirty || form.controls.confirmPassword.touched)), 'has-success':(!form.controls.confirmPassword.errors)}">
      <input type="password" class="form-control" id="confirmPwd" placeholder="Confirm the password" name="confirmPassword" formControlName='confirmPassword'>
      <ul class="help-block">
        <li *ngIf='form.controls.confirmPassword.errors?.required && (form.controls.confirmPassword.dirty || form.controls.confirmPassword.touched)'>
          This field is required
        </li>
        <li *ngIf='form.errors?.matchingPasswords && (form.controls.confirmPassword.dirty || form.controls.confirmPassword.touched)'>
          Password do not match
        </li>
      </ul>
    </div>

  </div>
  <div class="form-group">

    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" [disabled]="!form.valid || processing || !emailValid || !usernameValid" class="btn btn-default">Submit</button>
    </div>
  </div>
</form>
